<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Magazinify AI™ — Flipbook Viewer</title>
  <link rel="icon" href="/favicon.ico" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-950 text-white antialiased">
  <header class="sticky top-0 z-40 border-b border-white/10 bg-slate-950/70">
    <div class="mx-auto max-w-7xl px-6 py-4 flex items-center justify-between">
      <a href="/" class="flex items-center gap-3">
        <img src="/logo.svg" alt="Magazinify AI" class="h-7 w-7" />
        <span class="text-base font-semibold">Magazinify AI™</span>
      </a>
      <div class="flex items-center gap-3">
        <button id="printBtn" class="rounded-lg border border-white/20 px-3 py-2 text-sm hover:bg-white/5">Print</button>
        <a id="download" class="rounded-lg bg-white px-3 py-2 text-sm font-semibold text-slate-900 hover:bg-white/90" download>Download PDF</a>
      </div>
    </div>
  </header>

  <main class="mx-auto max-w-7xl px-6 py-8">
    <h1 class="text-2xl font-semibold">Flipbook Demo</h1>
    <p class="mt-2 text-white/70 text-sm">This is a demo preview. Replace with server-generated content later.</p>

    <!-- Progress -->
    <div id="progress" class="mt-6 h-2 w-full rounded bg-white/10 overflow-hidden">
      <div id="bar" class="h-2 w-0 bg-sky-400"></div>
    </div>

    <!-- Viewer -->
    <div class="mt-6 rounded-2xl border border-white/10 bg-white/5 p-3">
      <iframe id="preview" title="Flipbook Preview" class="h-[70vh] w-full rounded-xl border-0 bg-slate-900"></iframe>
    </div>
  </main>

  <script>
    const $ = (s)=>document.querySelector(s);
    function setBar(p){ $('#bar').style.width = p + '%'; }

    function buildPreviewHTML(){
      const pages = [
        `<section class="h-screen grid place-items-center" style="background: #0ea5e910;">
           <div class="text-center">
             <h1 class="text-3xl font-bold">Your Magazine Title</h1>
             <p class="text-white/70 mt-2">Style: Modern • Print Preview</p>
           </div>
         </section>`,
        `<section class="h-screen p-8">
           <h2 class="text-2xl font-semibold">Contents</h2>
           <ol class="mt-4 list-decimal pl-5 space-y-2 text-white/80">
             <li>Feature</li><li>Spotlight</li><li>Interview</li>
           </ol>
         </section>`,
        `<section class="h-screen p-8">
           <h2 class="text-2xl font-semibold">Feature</h2>
           <p class="mt-3 text-white/80">Replace this with real generated content in a later brick.</p>
         </section>`
      ];
      const html = `<!doctype html><meta charset="utf-8">
        <script src="https://cdn.tailwindcss.com"><\/script>
        <body class="bg-slate-950 text-white">
          ${pages.map(p=>`<div class="page">${p}</div>`).join('')}
          <style>
            @media print {.page{page-break-after: always;}}
          </style>
        </body>`;
      return URL.createObjectURL(new Blob([html], {type:"text/html"}));
    }

    function buildPDFStub(){
      const content = `%PDF-1.3
1 0 obj <</Type/Catalog/Pages 2 0 R>> endobj
2 0 obj <</Type/Pages/Count 1/Kids[3 0 R]>> endobj
3 0 obj <</Type/Page/Parent 2 0 R/MediaBox[0 0 612 792]/Contents 4 0 R/Resources<</Font<</F1 5 0 R>>>>>> endobj
4 0 obj <</Length 120>>stream
BT /F1 18 Tf 72 720 Td (Magazinify-AI Demo PDF) Tj T* (Replace with real render) Tj ET
endstream endobj
5 0 obj <</Type/Font/Subtype/Type1/BaseFont/Helvetica>> endobj
xref
0 6
0000000000 65535 f 
0000000010 00000 n 
0000000060 00000 n 
0000000117 00000 n 
0000000350 00000 n 
0000000460 00000 n 
trailer <</Size 6/Root 1 0 R>>
startxref
560
%%EOF`;
      return URL.createObjectURL(new Blob([content], {type:"application/pdf"}));
    }

    async function simulateLoad(){
      setBar(0);
      return new Promise((resolve)=>{
        let p=0; const t=setInterval(()=>{ p=Math.min(100,p+12+Math.random()*10); setBar(p); if(p>=100){clearInterval(t); resolve()} },160);
      });
    }

    (async()=>{
      await simulateLoad();
      $('#preview').src = buildPreviewHTML();
      $('#download').href = buildPDFStub();
      setBar(100);
    })();

    $('#printBtn').addEventListener('click', ()=>{
      const frame = document.getElementById('preview');
      if(frame?.contentWindow){ frame.contentWindow.focus(); frame.contentWindow.print(); }
    });
  </script>
</body>
</html>
